generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Bid {
  id            String    @id @default(cuid())
  auctionId     String
  bidderId      String
  amount        Decimal   @db.Decimal(10, 2)
  isAutomatic   Boolean   @default(false)
  maxAmount     Decimal?  @db.Decimal(10, 2)
  status        BidStatus @default(PENDING)
  placedAt      DateTime  @default(now())
  processedAt   DateTime?
  failureReason String?
  ipAddress     String?
  userAgent     String?

  @@index([auctionId])
  @@index([bidderId])
  @@index([placedAt])
  @@index([status])
  @@map("bids")
}

model BidHistory {
  id        String    @id @default(cuid())
  bidId     String
  auctionId String
  bidderId  String
  amount    Decimal   @db.Decimal(10, 2)
  timestamp DateTime  @default(now())
  action    BidAction

  @@index([bidId])
  @@index([auctionId])
  @@index([timestamp])
  @@map("bid_history")
}

model AutoBid {
  id        String   @id @default(cuid())
  auctionId String
  bidderId  String
  maxAmount Decimal  @db.Decimal(10, 2)
  increment Decimal  @db.Decimal(10, 2)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([auctionId, bidderId])
  @@index([auctionId])
  @@index([bidderId])
  @@index([isActive])
  @@map("auto_bids")
}

model BidValidation {
  id          String   @id @default(cuid())
  bidId       String   @unique
  auctionId   String
  bidderId    String
  validations Json
  isValid     Boolean
  errors      String[]
  createdAt   DateTime @default(now())

  @@index([auctionId])
  @@index([bidderId])
  @@index([isValid])
  @@map("bid_validations")
}

enum BidStatus {
  PENDING
  PROCESSING
  ACCEPTED
  REJECTED
  CANCELLED
  OUTBID
}

enum BidAction {
  PLACED
  ACCEPTED
  REJECTED
  CANCELLED
  OUTBID
  AUTO_BID_TRIGGERED
}
